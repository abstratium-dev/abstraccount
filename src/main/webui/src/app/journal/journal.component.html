<div class="container">
  <h1>Journal Viewer</h1>

  <!-- Error Display -->
  <div *ngIf="error" class="error-message">
    <h2>Error</h2>
    <p>{{ error }}</p>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading">
    <p>Loading...</p>
  </div>

  <!-- Journal Selection -->
  <div class="form-group" style="display: flex; gap: 1rem; align-items: flex-end;">
    <div style="flex: 1;">
      <label for="journal-select">Select Journal:</label>
      <select 
        id="journal-select" 
        [(ngModel)]="selectedJournal" 
        (change)="onJournalSelected()">
        <option [ngValue]="null">-- Select a journal --</option>
        <option *ngFor="let journal of journals" [ngValue]="journal">
          {{ journal.title }} ({{ journal.currency }})
        </option>
      </select>
    </div>
    <button 
      *ngIf="selectedJournal" 
      (click)="deleteJournal()" 
      class="btn-danger"
      [disabled]="loading">
      Delete Journal
    </button>
  </div>

  <!-- Filters -->
  <div *ngIf="selectedJournal" class="filter-section">
    <h3>Filters</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="start-date">Start Date:</label>
        <input 
          type="date" 
          id="start-date" 
          [(ngModel)]="startDate">
      </div>
      
      <div class="form-group">
        <label for="end-date">End Date:</label>
        <input 
          type="date" 
          id="end-date" 
          [(ngModel)]="endDate">
      </div>
    </div>
    
    <div class="form-group">
      <label for="status">Status:</label>
      <select id="status" [(ngModel)]="status">
        <option value="">All</option>
        <option value="CLEARED">Cleared</option>
        <option value="PENDING">Pending</option>
        <option value="UNCLEARED">Uncleared</option>
      </select>
    </div>
    
    <div class="form-actions">
      <button (click)="applyFilters()" class="btn-primary">Apply Filters</button>
      <button (click)="clearFilters()" class="btn-secondary">Clear</button>
    </div>
  </div>

  <!-- Transactions Table -->
  <div *ngIf="selectedJournal && transactions.length > 0">
    <h3>Transactions</h3>
    <table class="standard-table journal-table">
      <thead>
        <tr>
          <th style="width: 50px">Index</th>
          <th style="width: 120px">Date</th>
          <th style="width: 150px">Partner</th>
          <th>Description</th>
          <th style="text-align: right; width: 150px">Amount</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let transaction of transactions; let idx = index">
          <!-- Transaction Header Row -->
          <tr class="transaction-row">
            <td>{{ idx + 1 }}</td>
            <td>{{ transaction.date }}</td>
            <td>{{ transaction.partnerId || '' }}</td>
            <td>{{ transaction.description }}</td>
            <td></td>
          </tr>
          
          <!-- Tags Sub-row (if any) -->
          <tr *ngIf="transaction.tags.length > 0" class="sub-row tags-row">
            <td></td>
            <td></td>
            <td></td>
            <td class="tags-cell">
              <span *ngFor="let tag of transaction.tags" class="badge badge-secondary" style="margin-right: 0.5rem">
                {{ tag.value ? tag.key + ':' + tag.value : tag.key }}
              </span>
            </td>
            <td></td>
          </tr>
          
          <!-- Entry Sub-rows -->
          <tr *ngFor="let entry of transaction.entries" class="sub-row entry-row">
            <td></td>
            <td></td>
            <td></td>
            <td class="entry-description">
              <span class="entry-account">{{ entry.accountId }}</span>
              {{ entry.accountName }}
            </td>
            <td class="entry-amount" 
                [style.color]="entry.amount < 0 ? 'var(--color-error)' : 'var(--color-text-primary)'"
                style="text-align: right; font-family: monospace">
              {{ entry.commodity }} {{ formatAmount(entry.amount) }}
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
    
    <p style="text-align: right; color: var(--color-text-secondary); margin-top: 1rem">
      Total transactions: {{ transactions.length }}
    </p>
  </div>

  <!-- No Data Message -->
  <div *ngIf="selectedJournal && transactions.length === 0 && !loading" class="info-message">
    No transactions found for the selected filters.
  </div>

  <!-- No Journal Selected -->
  <div *ngIf="!selectedJournal && !loading" class="info-message">
    Please select a journal to begin.
  </div>
</div>

<style>
.journal-table .transaction-row {
  font-weight: 600;
  background-color: var(--color-bg-secondary);
}

.journal-table .sub-row {
  font-size: 0.9rem;
  background-color: var(--color-bg-primary);
}

.journal-table .tags-row {
  padding: 0.25rem 0;
}

.journal-table .tags-cell {
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.journal-table .entry-row {
  border-bottom: none;
}

.journal-table .entry-description {
  padding-left: 2rem;
}

.journal-table .entry-account {
  color: var(--color-link-primary);
  font-family: monospace;
  font-size: 0.85rem;
  margin-right: 0.5rem;
}

.journal-table .entry-amount {
  font-weight: 500;
}
</style>
